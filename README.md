# BOSS-Workerマルチエージェント評価システム

Ollamaモデルを使用してeコマースアプリケーションの階層的品質評価を行うBOSS-Workerマルチエージェントシステムです。

## 概要

このシステムは、BOSSエージェントがWorkerエージェントを統括し、プロジェクト全体の品質保証とリリース判定を行う階層的構造を採用しています：

### 🏗️ システム構造

```
👑 BOSS: BOSS_Agent (プロジェクト統括・品質保証マネージャー)
   ↓ 統合・判定
🔧 Workers:
   • ISTQB_Compliance_Worker (ISTQB準拠・法規制コンプライアンス確認者)
   • Management_Requirements_Worker (マネジメント・顧客要件確認者)
   • Technical_Analyst_Worker (テストアナリスト・技術者視点評価者)
```

### 🔄 処理フロー

1. **Step 1**: Workerエージェントが並行して専門評価を実行
2. **Step 1.5**: Workerエージェント間で会話・協調プロセス
3. **Step 2**: BOSSエージェントが結果を統合・分析
4. **Step 3**: 最終判定と改善ロードマップを生成

## 💬 Worker間会話機能

### 会話タイプ

システムでは、Workerエージェント間で以下の4種類の会話が行われます：

- **❓ 質問**: 専門分野間の情報交換
- **💬 回答**: 質問への専門的回答
- **🤝 協力**: 共同改善提案の検討
- **⚖️ 議論**: 異なる観点の建設的議論

### 会話プロセス

```
Worker A ──❓質問──→ Worker B
Worker A ←──💬回答─── Worker B
Worker A ──🤝協力──→ Worker B
Worker A ←──⚖️議論─── Worker B
```

### リアルタイム表示

会話はリアルタイムで表示され、各Workerの専門性を活かした建設的な議論が行われます：

```
╭──────────────────────────────────── Worker会話: ISTQB_Compliance_Worker → Technical_Analyst_Worker ────────────────────────────────────╮
│ ISTQB_Compliance_Worker → Technical_Analyst_Worker                                                                                    │
│ 質問 ❓                                                                                                                                │
│                                                                                                                                        │
│ Stripe API統合におけるセキュリティ面での実装について、PCI DSS準拠の観点からどのような確認が必要でしょうか？                           │
╰────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
```

## BOSS-Worker対応関係詳細

### 📋 階層的責任分担

```
┌─────────────────────────────────────────────────────────────────┐
│                    BOSSエージェント                            │
│              (プロジェクト統括・品質保証マネージャー)           │
├─────────────────────────────────────────────────────────────────┤
│ 役割:                                                          │
│ • 全体の品質保証戦略の策定                                     │
│ • Workerエージェントの評価結果統合                             │
│ • 最終的なリリース判定（Go/No-Go）                            │
│ • 改善ロードマップの策定                                       │
│ • リスク評価と優先度付け                                       │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Workerエージェント群                        │
├─────────────────┬─────────────────┬─────────────────────────────┤
│ ISTQB準拠・     │ マネジメント・   │ テストアナリスト・         │
│ 法規制コンプ    │ 顧客要件確認者   │ 技術者視点評価者           │
│ ライアンス確認者│                 │                           │
├─────────────────┼─────────────────┼─────────────────────────────┤
│ 専門分野:       │ 専門分野:        │ 専門分野:                  │
│ • PCI DSS準拠   │ • ビジネス価値  │ • フロントエンド技術       │
│ • 個人情報保護法│ • 市場適合性     │ • Stripe API統合           │
│ • 特定商取引法  │ • 顧客要件       │ • パフォーマンス・セキュリティ│
├─────────────────┼─────────────────┼─────────────────────────────┤
│ 評価基準:       │ 評価基準:        │ 評価基準:                  │
│ • 法的リスク    │ • ビジネスリスク│ • 技術的リスク             │
│ • コンプライアンス│ • 市場リスク   │ • セキュリティリスク       │
└─────────────────┴─────────────────┴─────────────────────────────┘
```

### 🔄 情報フローと意思決定プロセス

```
┌─────────────────────────────────────────────────────────────────┐
│                    評価対象アプリケーション                     │
│              (eコマースサイト・Stripe決済統合)                 │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Step 1: Worker並行評価                      │
├─────────────────┬─────────────────┬─────────────────────────────┤
│ ISTQB Worker    │ Management      │ Technical Worker            │
│ • 法的評価      │ Worker          │ • 技術的評価               │
│ • コンプライアンス│ • ビジネス評価 │ • セキュリティ評価         │
│ • リスク分析    │ • 市場分析      │ • パフォーマンス評価       │
└─────────────────┼─────────────────┼─────────────────────────────┘
                  │                 │
                  ▼                 ▼
┌─────────────────────────────────────────────────────────────────┐
│                Step 1.5: Worker間会話・協調                    │
├─────────────────┬─────────────────┬─────────────────────────────┤
│ ❓ 質問         │ 💬 回答         │ 🤝 協力                    │
│ ⚖️ 議論         │ 専門分野間      │ 共同改善提案               │
│ 建設的議論      │ 情報交換        │ 検討                       │
└─────────────────┼─────────────────┼─────────────────────────────┘
                  │                 │
                  ▼                 ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Step 2: BOSS統合評価                        │
├─────────────────────────────────────────────────────────────────┤
│ • Worker結果の分析・統合                                        │
│ • 全体品質レベルの判定                                          │
│ • リスク評価の統合                                              │
│ • 優先度の再評価                                                │
└─────────────────┬───────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Step 3: 最終判定・改善策                     │
├─────────────────────────────────────────────────────────────────┤
│ • リリース判定（Go/No-Go）                                     │
│ • 改善ロードマップ策定                                          │
│ • リスク分析レポート                                            │
│ • 優先度別改善項目                                              │
└─────────────────────────────────────────────────────────────────┘
```

### 📊 BOSS-Worker責任分担マトリックス

| 評価項目 | ISTQB Worker | Management Worker | Technical Worker | BOSS統合 |
|---------|-------------|------------------|-----------------|----------|
| **法的コンプライアンス** | ✅ 主要責任 | ⚠️ 補助評価 | ⚠️ 補助評価 | 🔍 最終判断 |
| **ビジネス価値** | ⚠️ 補助評価 | ✅ 主要責任 | ⚠️ 補助評価 | 🔍 最終判断 |
| **技術的品質** | ⚠️ 補助評価 | ⚠️ 補助評価 | ✅ 主要責任 | 🔍 最終判断 |
| **セキュリティ** | ✅ 主要責任 | ⚠️ 補助評価 | ✅ 主要責任 | 🔍 最終判断 |
| **ユーザー体験** | ⚠️ 補助評価 | ✅ 主要責任 | ✅ 主要責任 | 🔍 最終判断 |
| **リスク評価** | ✅ 法的リスク | ✅ ビジネスリスク | ✅ 技術的リスク | 🔍 統合リスク |
| **優先度付け** | ✅ 法的優先度 | ✅ ビジネス優先度 | ✅ 技術的優先度 | 🔍 統合優先度 |

### 🎯 評価基準と判定ロジック

#### Workerエージェントの評価基準

**ISTQB Worker**:
- **高リスク**: PCI DSS非準拠、個人情報保護法違反
- **中リスク**: 特定商取引法の不備
- **低リスク**: 軽微な法的要件の不備

**Management Worker**:
- **高リスク**: ビジネスモデルの根本的欠陥
- **中リスク**: 市場適合性の課題
- **低リスク**: 機能改善の余地

**Technical Worker**:
- **高リスク**: セキュリティ脆弱性、データ漏洩リスク
- **中リスク**: パフォーマンス問題、技術的負債
- **低リスク**: コード品質の改善余地

#### BOSSエージェントの統合判定ロジック

```
最終判定 = f(法的リスク, ビジネスリスク, 技術的リスク)

Go判定条件:
- 高リスク問題: 0件
- 中リスク問題: ≤2件
- 低リスク問題: 制限なし

No-Go判定条件:
- 高リスク問題: ≥1件
- 中リスク問題: ≥3件
```

### 🔄 改善サイクルとフィードバックループ

```
┌─────────────────────────────────────────────────────────────────┐
│                    継続的改善サイクル                           │
├─────────────────────────────────────────────────────────────────┤
│ 1. Worker評価 → 2. Worker会話 → 3. BOSS統合 → 4. 改善策策定 → 5. 実装 → 1. 再評価 │
└─────────────────────────────────────────────────────────────────┘

詳細フロー:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Worker評価   │───▶│ Worker会話   │───▶│ BOSS統合    │───▶│ 改善策策定  │───▶│ 実装・検証  │
│ • 専門評価   │    │ • 質問・回答│    │ • 結果統合  │    │ • ロードマップ│    │ • 改善実装  │
│ • リスク分析│    │ • 協力・議論│    │ • 最終判定  │    │ • 優先度付け│    │ • 効果測定  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
        ▲                                                                                   │
        │                                                                                   │
        └─────────────────────────── フィードバックループ ───────────────────────────────────┘
```

## エージェント詳細

### 👑 BOSSエージェント

**使用モデル**: `pakachan/elyza-llama3-8b:latest`

**役割**:
- 各Workerエージェントの評価結果を分析・統合
- プロジェクト全体の品質レベルを判定
- リリース判定（Go/No-Go）の最終決定
- 改善ロードマップの策定
- リスク評価と優先度付け

### 🔧 Workerエージェント

#### ISTQB準拠・法規制コンプライアンス確認者

**使用モデル**: `pakachan/elyza-llama3-8b:latest`

**評価項目**:
- PCI DSS準拠状況
- 個人情報保護法への適合性
- 特定商取引法への準拠

#### マネジメント・顧客要件確認者

**使用モデル**: `gemma3:latest`

**評価項目**:
- Stripe決済統合による売上向上目標
- 日本市場限定戦略の実装
- ユーザー体験向上に寄与する機能

#### テストアナリスト・技術者視点評価者

**使用モデル**: `llama3.2:latest`

**評価項目**:
- フロントエンド技術スタックの適切性
- Stripe API統合の技術的実装品質
- パフォーマンスとセキュリティ

## 前提条件

- Python 3.8以上
- Ollamaサーバーが起動していること（http://localhost:11434）
- 必要なモデルがインストールされていること

### 必要なOllamaモデル

- `gemma3:latest`
- `pakachan/elyza-llama3-8b:latest`
- `llama3.2:latest`

## インストール

1. 依存関係をインストール：
```bash
pip install -r requirements.txt
```

2. Ollamaサーバーが起動していることを確認：
```bash
curl http://localhost:11434/api/tags
```

## 使用方法

### 基本的な実行

```bash
python main.py run
```

### オプション付きの実行

```bash
python main.py run --url "https://your-app.com" --source "https://github.com/your-repo" --output "report.json"
```

### 会話機能の制御

```bash
# 会話を有効にして実行（デフォルト）
python main.py run --conversations

# 会話を無効にして実行
python main.py run --no-conversations
```

### 接続テスト

```bash
python main.py test-connection
```

### 設定確認

```bash
python main.py show-config
```

### システム構造確認

```bash
python main.py show-structure
```

### 会話プレビュー機能

```bash
python main.py preview-conversations
```

## コマンドラインオプション

### `run` コマンド

- `--url, -u`: 評価対象のアプリケーションURL（デフォルト: https://ecommerce-with-stripe-six.vercel.app/）
- `--source, -s`: ソースコードリポジトリURL（デフォルト: https://github.com/kychan23/ecommerce-with-stripe）
- `--save/--no-save`: レポートをファイルに保存するかどうか（デフォルト: True）
- `--output, -o`: 出力ファイル名（指定しない場合は自動生成）
- `--conversations/--no-conversations`: Worker間の会話をリアルタイムで表示するかどうか（デフォルト: True）

## 出力

### コンソール出力

- リアルタイムの評価進行状況（Step 1: Worker評価、Step 1.5: Worker会話、Step 2: BOSS統合）
- Workerエージェント間の会話（質問、回答、協力、議論）
- 各Workerエージェントの評価結果
- BOSSエージェントの統合評価結果
- 最終的な品質リリース判定（Go/No-Go）
- 改善ロードマップ

### JSONレポート

以下の構造でJSONファイルが生成されます：

```json
{
  "timestamp": "2024-01-01T12:00:00",
  "project_structure": {
    "boss_agent": "BOSS_Agent",
    "worker_agents": ["ISTQB_Compliance_Worker", "Management_Requirements_Worker", "Technical_Analyst_Worker"],
    "total_agents": 4
  },
  "boss_evaluation": {
    "agent_name": "BOSS_Agent",
    "role": "プロジェクト統括・品質保証マネージャー",
    "overall_evaluation": "統合評価結果",
    "final_decision": "Go",
    "risk_analysis": "リスク分析",
    "improvement_roadmap": ["短期改善項目", "中期改善項目", "長期改善項目"]
  },
  "worker_summary": {
    "total_workers": 3,
    "high_priority_issues": 0,
    "medium_priority_issues": 3,
    "low_priority_issues": 0,
    "high_risk_issues": 0,
    "medium_risk_issues": 3,
    "low_risk_issues": 0
  },
  "worker_results": [...],
  "worker_conversations": [
    {
      "from_agent": "ISTQB_Compliance_Worker",
      "to_agent": "Technical_Analyst_Worker",
      "message": "会話内容",
      "timestamp": "2024-01-01T12:00:00",
      "conversation_type": "question"
    }
  ],
  "issues_by_priority": {...},
  "issues_by_risk": {...}
}
```

## BOSS-Worker構造の利点

### 🎯 階層的品質保証

- **専門性の分離**: 各Workerが専門分野に特化
- **統合的な判断**: BOSSが全体を俯瞰して最終判断
- **効率的な並行処理**: Workerが同時に評価を実行
- **協調的改善**: Worker間の会話による品質向上

### 📊 包括的な評価

- **法的コンプライアンス**: ISTQB準拠の品質保証
- **ビジネス価値**: 顧客要件と市場適合性
- **技術的品質**: アーキテクチャとセキュリティ

### 🔄 改善サイクル

- **短期改善**: 緊急度の高い問題の解決
- **中期改善**: 機能拡張とユーザビリティ向上
- **長期改善**: 戦略的な品質向上

### 💬 協調的品質保証

- **専門分野間の情報交換**: 質問・回答による知識共有
- **共同改善提案**: 複数専門分野を組み合わせた提案
- **建設的議論**: 異なる観点からの検討
- **リアルタイム協調**: 即座のフィードバックと改善

## トラブルシューティング

### Ollamaサーバーに接続できない

1. Ollamaサーバーが起動しているか確認：
```bash
ollama serve
```

2. ポート11434が利用可能か確認：
```bash
curl http://localhost:11434/api/tags
```

### モデルが見つからない

必要なモデルをインストール：
```bash
ollama pull gemma3:latest
ollama pull pakachan/elyza-llama3-8b:latest
ollama pull llama3.2:latest
```

### 評価が失敗する

1. モデルのダウンロード状況を確認
2. メモリ不足の場合は、より軽量なモデルに変更
3. タイムアウト設定を調整（config.py）

### 会話機能が動作しない

1. 会話表示オプションが有効になっているか確認
2. モデルの応答時間が長い場合は、タイムアウト設定を調整
3. メモリ不足の場合は、会話数を制限

## カスタマイズ

### 新しいWorkerエージェントの追加

1. `config.py`の`WORKER_CONFIGS`に新しいWorker設定を追加
2. `agent.py`に新しいWorkerクラスを実装
3. `create_agent`関数に新しいWorkerの判定ロジックを追加

### BOSSエージェントの設定変更

`config.py`の`BOSS_CONFIG`で以下の設定を変更できます：
- 使用モデル
- システムプロンプト
- 評価基準
- 判定ロジック

### 会話機能のカスタマイズ

`agent.py`の`_create_conversation_prompt`メソッドで以下の設定を変更できます：
- 会話タイプの追加
- プロンプトの調整
- 会話ルールの変更

### 設定の変更

`config.py`で以下の設定を変更できます：
- OllamaサーバーのURL
- タイムアウト時間
- 最大トークン数
- エージェントのシステムプロンプト
- 使用モデルの割り当て

## ライセンス

MIT License

## 貢献

プルリクエストやイシューの報告を歓迎します。 